// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  username      String   @unique
  password      String
  emailVerified         Boolean  @default(false)
  verificationToken     String?
  verificationTokenExpiry DateTime?
  resetToken            String?
  resetTokenExpiry      DateTime?
  refreshToken          String?
  refreshTokenExpiry    DateTime?
  name          String?
  bio           String?
  avatar        String?
  location      String?
  website       String?
  github        String?
  twitter       String?
  linkedin      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Profile fields
  skills        String[] @default([])
  interests     String[] @default([])
  hackathonHistory HackathonHistory[]
  projects      Project[]

  // Relationships
  sentInvitations     Invitation[] @relation("InvitationSender")
  receivedInvitations Invitation[] @relation("InvitationReceiver")
  matchesAsUser1      Match[]      @relation("MatchUser1")
  matchesAsUser2      Match[]      @relation("MatchUser2")

  @@index([username])
  @@index([email])
}

model Hackathon {
  id          String   @id @default(cuid())
  name        String
  description String?
  startDate   DateTime
  endDate     DateTime
  location    String?
  website     String?
  logo        String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  history     HackathonHistory[]

  @@index([startDate])
}

model HackathonHistory {
  id         String   @id @default(cuid())
  userId     String
  hackathonId String
  role       String?  // e.g., \"Frontend Developer\", \"Backend Developer\", \"Designer\"
  result     String?  // e.g., \"Winner\", \"Finalist\", \"Participant\"
  projectUrl String?
  notes      String?
  createdAt  DateTime @default(now())

  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  hackathon  Hackathon  @relation(fields: [hackathonId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([hackathonId])
}

model Project {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  url         String?
  githubUrl   String?
  imageUrl    String?
  tags        String[] @default([])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Invitation {
  id        String   @id @default(cuid())
  senderId  String
  receiverId String
  message   String?
  status    InvitationStatus @default(PENDING)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sender    User     @relation("InvitationSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver  User     @relation("InvitationReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
  @@index([senderId])
  @@index([receiverId])
  @@index([status])
}

model Match {
  id        String   @id @default(cuid())
  user1Id   String
  user2Id   String
  createdAt DateTime @default(now())

  user1     User     @relation("MatchUser1", fields: [user1Id], references: [id], onDelete: Cascade)
  user2     User     @relation("MatchUser2", fields: [user2Id], references: [id], onDelete: Cascade)

  @@unique([user1Id, user2Id])
  @@index([user1Id])
  @@index([user2Id])
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  REJECTED
}
